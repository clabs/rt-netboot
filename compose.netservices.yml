version: '3.6'

networks:
  netservices: {}
  proxy: {}
  networks:
  dns-ipv6:
    enable_ipv6: true
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 2001:3200:3200::/64
        - gateway: 2001:3200:3200::1

services:
  # dhcpd
  dhcpd:
    container_name: dhcpd
    image: networkboot/dhcpd:latest
    network_mode: host
    restart: always
    volumes:
      - ./dhcpd:/data

  # bind
  #bind:
  #  container_name: bind
  #  image: resystit/bind9:latest
  #  volumes:
  #    - ./bind/named.conf:/etc/bind/named.conf
  #  ports:
  #    - 53:53
  #    - '${HOST_IP}:53:53/udp'
  #  networks:
  #    - netservices

  # pihole
  pihole:
    container_name: pihole
    image: pihole/pihole:latest
    restart: always
    ports:
      - '53:53/tcp'
      - '53:53/udp'
      - '1337:80/tcp'
    environment:
      TZ: 'Europe/Berlin'
      WEBPASSWORD: '13nimda37'
      # VIRTUAL_HOST: pihole.local.rocktreff.de
    labels:
      - traefik.frontend.rule=Host:pihole.local.rocktreff.de
      - traefik.port=80
    volumes:
      - './pihole/etc/pihole:/etc/pihole/'
      - './pihole/etc/dnsmasq.d:/etc/dnsmasq.d/'
    dns:
      - 127.0.0.1
      - 1.1.1.1
    networks:
      - netservices
      - proxy
      app_net:
        ipv6_address: 2001:3200:3200::20

  pdns-recursor:
    container_name: pdns-recursor
    image: 'tcely/powerdns-recursor'
    restart: 'always'
    command:
      [
        '--disable-syslog=yes',
        '--log-timestamp=no',
        '--local-address=0.0.0.0',
        '--setuid=pdns-recursor',
        '--setgid=pdns-recursor',
      ]
    volumes:
      - ./powerdns:/etc/powerdns
    expose:
      - '53/tcp'
      - '53/udp'
    ports:
      - '127.0.0.1:5353:53/tcp'
      - '127.0.0.1:5353:53/udp'
    networks:
      - netservices
